(function(){var e={2785:function(e,t,a){"use strict";var s=a(9003),o=a(2483);const n=(0,s._)("h3",null," 机器人通信Dome(通信方式不要按照我这种来，最好采用通讯池的方式，接收和发送都在通讯池中处理) ",-1),i=(0,s._)("p",null,"通讯格式为:帧头、数据长度、指令、数据、校验位",-1),r=(0,s._)("p",null,null,-1),l=(0,s._)("p",null,null,-1);function c(e,t,a,o,c,h){const u=(0,s.up)("el-button");return(0,s.wg)(),(0,s.iD)("div",null,[n,i,(0,s.Wm)(u,{type:"primary",onClick:t[0]||(t[0]=e=>h.GO_Convoy_Seven())},{default:(0,s.w5)((()=>[(0,s.Uk)("变七")])),_:1}),(0,s.Wm)(u,{type:"primary",onClick:t[1]||(t[1]=e=>h.GO_Bumblebee())},{default:(0,s.w5)((()=>[(0,s.Uk)("大黄蜂")])),_:1}),(0,s.Wm)(u,{type:"primary",onClick:t[2]||(t[2]=e=>h.GO_SteelCable())},{default:(0,s.w5)((()=>[(0,s.Uk)("钢索")])),_:1}),r,(0,s.Wm)(u,{type:"primary",onClick:t[3]||(t[3]=e=>h.GO_Bluetooth())},{default:(0,s.w5)((()=>[(0,s.Uk)("变七蓝牙测试")])),_:1}),(0,s.Wm)(u,{type:"primary",onClick:t[4]||(t[4]=e=>h.GO_BluetoothBumblebee())},{default:(0,s.w5)((()=>[(0,s.Uk)("大黄蜂蓝牙测试")])),_:1}),(0,s.Wm)(u,{type:"primary",onClick:h.GO_BluetoothSteelCable},{default:(0,s.w5)((()=>[(0,s.Uk)(" 钢索蓝牙测试 ")])),_:1},8,["onClick"]),(0,s.Wm)(u,{type:"primary",onClick:h.Go_BluetoothBazz},{default:(0,s.w5)((()=>[(0,s.Uk)(" 巴斯光年蓝牙测试 ")])),_:1},8,["onClick"]),l,(0,s.Wm)(u,{type:"primary",onClick:h.Go_facTest},{default:(0,s.w5)((()=>[(0,s.Uk)(" 抽象接口测试 ")])),_:1},8,["onClick"])])}var h=a(4693),u=a.n(h),p={data(){return{msg:"aaa",ports:[],abc:[]}},methods:{async requestSerialPort(){try{const e=await navigator.serial.requestPort();console.log(e)}catch(e){console.error(e)}},async getSerialPorts(){try{this.ports=await navigator.serial.getPorts(),console.log(this.ports)}catch(e){console.error(e)}},GO_Convoy_Seven(){this.$router.replace("/Convoy_Seven")},GO_Bumblebee(){this.$router.replace("/Bumblebee")},async GO_SteelCable(){this.$router.replace("/SteelCable")},async GO_Bluetooth(){this.$router.replace("/Bluetooth")},async GO_BluetoothBumblebee(){this.$router.replace("/BluetoothBumblebee")},async GO_BluetoothSteelCable(){this.$router.replace("/BluetoothSteelCable")},async Go_BluetoothBazz(){this.$router.replace("/BluetoothBazz")},async Go_facTest(){this.$router.replace("/TestFactory")},async f(){}},mounted(){this.f()}},d=a(89);const f=(0,d.Z)(p,[["render",c]]);var g=f;const m=(0,s._)("h3",null,"变七机器人通讯结构",-1),v=(0,s._)("p",null,"连接方式 : 串口",-1),w=(0,s._)("p",null,"配置参数baudRate : 115200",-1),_=(0,s._)("p",null,"配置参数parity : 0",-1),b=(0,s._)("p",null,"配置参数dataBits : 8",-1),P=(0,s._)("p",null,"配置参数stopBits : 1",-1),y=(0,s._)("label",null,[(0,s.Uk)(" 连接成功后，发送[0xFF, 0xFF, 0x02, 0xF5, 0xF7] 指令0xF5是进入PC编程模式 0xF7是(指令+数据)和%256的结果 "),(0,s._)("br"),(0,s.Uk)(" 发送后接收数据直到接收[0xFF,0xFF,0x04 0xF4,0x4F 0x4B,0x93] 当中的数据需要进行处理")],-1),k=(0,s._)("p",null,null,-1),D=(0,s._)("label",null,"关闭需要发送指令 [0xFF, 0xFF, 0x02, 0xF6, 0xF8] 然后断开端口",-1),S=(0,s._)("p",null,null,-1),F=(0,s._)("label",null,"例如:左肩旋转: ",-1),L=(0,s._)("label",null,"控制舵机移动[0xFF,0xFF,数据长度,指令(0x01),数据(位置+速度),sum和]指定左肩的下标控制",-1),M=(0,s._)("p",null,null,-1),I=(0,s._)("label",null,"初始位置在人形的时候就已经读取过，具体是那个看代码，保存指令为[0xFF,0xFF,数据长度,指令(0x03) 数据,sum和] 更改方式也是指定的某个轴的下标",-1),A=(0,s._)("p",null,null,-1),N=(0,s._)("label",null,"初始位置在人形的时候就已经读取过，具体是那个看代码，保存指令为[0xFF,0xFF,数据长度,指令(0x0F) 数据,sum和] 更改方式也是指定的某个轴的下标",-1),x=(0,s._)("p",null,null,-1),C=(0,s._)("p",null,null,-1),T=(0,s._)("label",null,"下载是将pc上的数据载入到机器人当中，这里用一个.shr机器人保存再本地的文件开始,下载的指令顺序是:删除(0x15),创建(0x14),修改(0x17),下载(0x02)",-1),U=(0,s._)("p",null,null,-1),B=(0,s._)("label",null,"这个地方有个bug就是文件名是数字且这个数字小于10的情况下发送到机器人的数据会多一个具体原因不明(感觉是机器人内部处理的问题，用纯PC的软件不会)",-1),E=(0,s._)("p",null,null,-1),O=(0,s._)("h4",null,"上传功能",-1),R=(0,s._)("label",null,"上传功能首先需要读取一下机器人内部的上传动作文件名",-1),W=(0,s._)("p",null,null,-1),G=(0,s._)("label",null,"以绝对路径读取文件夹指令为[0xFF,0xFF,数据长度,指令(0x1A) 数据,sum和]",-1),V=(0,s._)("p",null,null,-1),Z=(0,s._)("label",null,"上传，先选择要上传的文件，然后发送指令[0xFF,0xFF,数据长度,指令(0x16),0x3B,(固定数据) 数据(文件名称数据),sum和]",-1);function q(e,t,a,o,n,i){const r=(0,s.up)("el-button"),l=(0,s.up)("el-input"),c=(0,s.up)("el-option"),h=(0,s.up)("el-select");return(0,s.wg)(),(0,s.iD)(s.HY,null,[m,v,w,_,b,P,(0,s.Wm)(r,{type:"primary",onClick:t[0]||(t[0]=e=>i.requestSerialPort())},{default:(0,s.w5)((()=>[(0,s.Uk)("连接")])),_:1}),y,k,(0,s.Wm)(r,{type:"primary",onClick:t[1]||(t[1]=e=>i.closePose())},{default:(0,s.w5)((()=>[(0,s.Uk)("关闭")])),_:1}),D,S,(0,s.Wm)(r,{type:"primary",onClick:t[2]||(t[2]=e=>i.timeSendingPosition())},{default:(0,s.w5)((()=>[(0,s.Uk)("时时发送位置")])),_:1}),F,(0,s.Wm)(l,{modelValue:n.ArmInput,"onUpdate:modelValue":t[3]||(t[3]=e=>n.ArmInput=e),style:{width:"50px"}},null,8,["modelValue"]),L,M,(0,s.Wm)(r,{type:"primary",onClick:t[4]||(t[4]=e=>i.humanoidInitial())},{default:(0,s.w5)((()=>[(0,s.Uk)("人形初始位置保存")])),_:1}),I,A,(0,s.Wm)(r,{type:"primary",onClick:t[5]||(t[5]=e=>i.squatStart())},{default:(0,s.w5)((()=>[(0,s.Uk)("下蹲初始位置")])),_:1}),N,x,(0,s._)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>i.actionDownload&&i.actionDownload(...e))},null,32),(0,s.Uk)(" 下载功能 "),C,T,U,B,E,O,R,W,(0,s.Wm)(r,{type:"primary",onClick:t[7]||(t[7]=e=>i.getActionName())},{default:(0,s.w5)((()=>[(0,s.Uk)("读取")])),_:1}),(0,s.Wm)(h,{modelValue:n.selectedOption,"onUpdate:modelValue":t[8]||(t[8]=e=>n.selectedOption=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.vOpentions,(e=>((0,s.wg)(),(0,s.j4)(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),G,V,(0,s.Wm)(r,{type:"primary",onClick:t[9]||(t[9]=e=>i.getAction())},{default:(0,s.w5)((()=>[(0,s.Uk)(" 上传")])),_:1}),Z],64)}a(1439),a(7585),a(5315),a(7658);class H{constructor({number:e,Name:t,Pos:a,Speed:s,Delay:o,Loop_Time:n,Is_Loop_Start:i,Is_Loop_End:r,Music_State:l,Music_Number:c}){this.number=e,this.Name=t,this.Pos=a,this.Speed=s,this.Delay=o,this.Loop_Time=n,this.Is_Loop_Start=i,this.Is_Loop_End=r,this.Music_State=l,this.Music_Number=c}}function z(e){return new H({number:e.number,Name:e.Name,Pos:e.Pos,Speed:e.Speed,Delay:e.Delay,Loop_Time:e.Loop_Time,Is_Loop_Start:e.Is_Loop_Start,Is_Loop_End:e.Is_Loop_End,Music_State:e.Music_State,Music_Number:e.Music_Number})}var j={data(){return{port:{},isLink:!1,initData:[],ArmInput:0,dataArr:[],selectedOption:"",vOpentions:[]}},methods:{async requestSerialPort(){try{const o=await navigator.serial.requestPort();if(null!=o){await o.open({baudRate:115200,parity:"none",dataBits:8,stopBits:1,bufferSize:4096}),this.port=o;const n=new Uint8Array([255,255,2,245,247]),i=o.writable.getWriter();await i.write(n),await i.releaseLock();const r=await o.readable.getReader();this.isLink=!1;var e=[];while(1){if(1==this.isLink){r.releaseLock();break}const{value:s,done:o}=await r.read();if(o){r.releaseLock();break}for(let t=0;t<s.length;t++)e[e.length]=s[t];for(let n=0;n<e.length;n++)if(255==e[n]&&255==e[n+1]){var t=e[n+2],a=e[n+3];if(4==t&&245==a&&79==e[n+4]&&75==e[n+5]&&e[n+6]==(t+a+79+75)%256){this.isLink=!0;break}}}let l=0;for(let o=0;o<e.length;o++)if(255==e[o]&&255==e[o+1]){t=e[o+2],a=e[o+3];if(50==t&&245==a){var s=[];for(let t=0;t<48;t++)s[t]=e[o+t+4];o+=52,this.initData[l]=s,l++}}}}catch(o){console.error(o)}},async closePose(){try{const e=new Uint8Array([255,255,2,246,248]),t=this.port.writable.getWriter();await t.write(e),this.isLink=!1}catch(e){console.error(e)}},async timeSendingPosition(){try{if(1==this.isLink){var e=this.initData[0];e[12]+=parseInt(this.ArmInput),e[e.length]=25;var t=[];t[0]=255,t[1]=255,t[2]=51,t[3]=1;var a=52;for(let s=0;s<e.length;s++)t[4+s]=e[s],a+=e[s];a%=256,t[t.length]=a;var s=new Uint8Array(t);const o=this.port.writable.getWriter();await o.write(s),await o.releaseLock()}}catch(o){console.error(o)}},async humanoidInitial(){try{if(1==this.isLink){var e=this.initData[0],t=[];t[0]=255,t[1]=255,t[2]=50,t[3]=3;var a=53;for(let s=0;s<e.length;s++)t[4+s]=e[s],a+=e[s];a%=256,t[t.length]=a,console.log(t);var s=new Uint8Array(t);const o=this.port.writable.getWriter();await o.write(s),await o.releaseLock()}}catch(o){console.error(o)}},async squatStart(){try{if(1==this.isLink){var e=this.initData[2],t=[];t[0]=255,t[1]=255,t[2]=50,t[3]=15;var a=65;for(let s=0;s<e.length;s++)t[4+s]=e[s],a+=e[s];a%=256,t[t.length]=a,console.log(t);var s=new Uint8Array(t);const o=this.port.writable.getWriter();await o.write(s),await o.releaseLock()}}catch(o){console.error(o)}},async actionDownload(e){try{const t=e.target.files[0],a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=async e=>{const t=e.target.result,a=t.trim().split("\n").length;this.dataArr=[];for(let u=0;u<a;u++){const e=t.split("\r\n")[u].split(",")[0],a=e.split(/\s+/).map((e=>isNaN(e)?e:""==e?" ":Number(e)));this.dataArr.push(a)}if(1==this.isLink){var s=[],o=[],n=this.dataArr,i=n.length;for(let t=0;t<i;t++){var r=!1;" "==n[t][0]&&(r=!0),253==n[t][0]&&253==n[t][1]&&254==n[t][2]&&" "!=n[t][3]&&s.push(n[t][3]),1==r&&o.push(n[t])}var l=0;i=o.length;var c=[];for(let t=0;t<i;t++){var h=o[t][5],p=o[t][6],d=o[t][7],f=o[t][8],g=o[t][9],m=o[t][10];for(let s=0;s<8;s++){let e=h&Math.pow(2,7-s);0!=e&&(o[t][s+11]*=-1)}for(let s=0;s<8;s++){let e=p&Math.pow(2,7-s);0!=e&&(o[t][s+19]*=-1)}for(let s=0;s<8;s++){let e=d&Math.pow(2,7-s);0!=e&&(o[t][s+27]*=-1)}for(let s=0;s<8;s++){let e=f&Math.pow(2,7-s);0!=e&&(o[t][s+35]*=-1)}for(let s=0;s<8;s++){let e=g&Math.pow(2,7-s);0!=e&&(o[t][s+43]*=-1)}for(let s=0;s<8;s++){let e=m&Math.pow(2,7-s);0!=e&&(o[t][s+51]*=-1)}var v=0,w=!1,_=!1;0!=o[t][4]&&o[t][4]>128?v=o[t][4]-128:0!=o[t][4]&&o[t][4]<128?(v=o[t][4],w=!1,_=!0):0==o[t][4]&&(w=!1,_=!1);var b=[],P=o[t][3];for(let s=0;s<48;s++)b[s]=o[t][s+11];var y=o[t][59],k=o[t][60],D=0;let e=-1,a=-1;251!=o[t][61]&&251!=o[t][62]&&252!=o[t][61]&&252!=o[t][62]?(a=256*o[t][61]+o[t][62],D=2):251==o[t][61]&&251==o[t][62]?D=4:252==o[t][61]&&252==o[t][62]&&(D=3),e=a,0!=o[t][4]&&(w=0==l,o[t][4]<128?(_=!0,v=o[t][4]):(_=!1,v=o[t][4]-128)),l=o[t][4]>128?o[t][4]:0;var S={number:P,Name:1,Pos:b,Speed:y,Delay:k,Loop_Time:v,Is_Loop_Start:w,Is_Loop_End:_,Music_State:D,Music_Number:e};c.push(z(S))}i=c.length;let e=0;v=-1;var F=!1,L=[[]],M=c[0].number;L[0]=[];for(let t=0;t<i;t++){M!=c[t].number&&(M=c[t].number,e++,L[e]=[]);var I=[];I.push(255),I.push(255),I.push(61),I.push(2),F||(I[4]=0),!F||c[t].Is_Loop_Start||c[t].Is_Loop_End||(I[4]=v+128),c[t].Is_Loop_End&&(F=!1,I[4]=v,v=0),c[t].Is_Loop_Start&&(F=!0,v=c[t].Loop_Time,I[4]=v+128);var A=0,N=0,x=0,C=0,T=0,U=0;for(let e=0;e<48;e++)e<8&&c[t].Pos[e]<0&&(A+=parseInt(Math.pow(2,7-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=8&&e<16&&c[t].Pos[e]<0&&(N+=parseInt(Math.pow(2,15-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=16&&e<24&&c[t].Pos[e]<0&&(x+=parseInt(Math.pow(2,23-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=24&&e<32&&c[t].Pos[e]<0&&(C+=parseInt(Math.pow(2,31-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=32&&e<40&&c[t].Pos[e]<0&&(T+=parseInt(Math.pow(2,39-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=40&&e<48&&c[t].Pos[e]<0&&(U+=parseInt(Math.pow(2,47-e)),c[t].Pos[e]=-1*c[t].Pos[e]);I[5]=A,I[6]=N,I[7]=x,I[8]=C,I[9]=T,I[10]=U;for(let e=0;e<48;e++)I[e+11]=c[t].Pos[e];switch(I[59]=c[t].Speed,I[60]=c[t].Delay,c[t].Music_State){case 1:I[61]=parseInt(c[t].Music_Number/256),I[62]=parseInt(c[t].Music_Number%256);break;case 2:I[61]=parseInt(c[t].Music_Number/256),I[62]=parseInt(c[t].Music_Number%256);break;case 3:I[61]=252,I[62]=252;break;case 4:I[61]=251,I[62]=251;break}var B=0;for(let e=2;e<63;e++)B+=I[e];B%=256,I[63]=B,L[e].push(I)}console.log(L),i=s.length;for(let t=0;t<i;t++){let e=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await e;var E=s[t];console.log(E);var O=E.substring(0,4),R=E.substring(4);"地面::"==O?O="GroundAction/":"凌空::"==O&&(O="VolleyAction/"),R=O+R;var W=Array.from(u().encode(R,"utf8")),G=W.length,V=G+2,Z=[];Z[0]=255,Z[1]=255,Z[2]=V,Z[3]=21;B=V+21;for(let t=0;t<G;t++)Z.push(W[t]),B+=W[t];B%=256,Z.push(B);var q=new Uint8Array(Z);const a=this.port.writable.getWriter();await a.write(q);const o=await this.port.readable.getReader();var H=[],j=!1;while(!j){const{value:e,done:t}=await o.read();if(t){o.releaseLock();break}for(let a=0;a<e.length;a++)H[H.length]=e[a];for(let a=0;a<H.length;a++)if(255==H[a]&&255==H[a+1]){var Y=H[a+3];21==Y&&79==H[a+4]&&75==H[a+5]&&(j=!0)}}let n=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await n,Z[3]=20,Z[Z.length-1]=Z[Z.length-1]-1,q=new Uint8Array(Z),await a.write(q),H=[],j=!1;while(!j){const{value:e,done:t}=await o.read();if(t){o.releaseLock();break}for(let a=0;a<e.length;a++)H[H.length]=e[a];for(let a=0;a<H.length;a++)if(255==H[a]&&255==H[a+1]){Y=H[a+3];20==Y&&79==H[a+4]&&75==H[a+5]&&(j=!0)}}let i=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await i,Z=[],B=0,R+=".sh",console.log(R),W=Array.from(u().encode(R,"gb2312")),G=W.length,V=G+2,Z[0]=255,Z[1]=255,Z[2]=V,Z[3]=23,B=V+23;for(let t=0;t<G;t++)Z.push(W[t]),B+=W[t];B%=256,Z.push(B),q=new Uint8Array(Z),await a.write(q),H=[],j=!1;while(!j){const{value:e,done:t}=await o.read();if(t){o.releaseLock();break}for(let a=0;a<e.length;a++)H[H.length]=e[a];for(let a=0;a<H.length;a++)if(255==H[a]&&255==H[a+1]){Y=H[a+3];23==Y&&79==H[a+4]&&75==H[a+5]&&(j=!0)}}let r=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await r,console.log(L[t]);for(let s=0;s<L[t].length;s++){let e=new Promise(((e,t)=>{setTimeout((()=>e()),150)}));await e;var $=new Uint8Array(L[t][s]);await a.write($),H=[],j=!1;while(!j){const{value:e,done:t}=await o.read();if(t){o.releaseLock();break}for(let a=0;a<e.length;a++)H[H.length]=e[a];for(let a=0;a<H.length;a++)if(255==H[a]&&255==H[a+1]){Y=H[a+3];2==Y&&79==H[a+4]&&75==H[a+5]&&(console.log(a+" "+H),j=!0)}}}await a.releaseLock(),await o.releaseLock()}}}}catch(t){console.error(t)}},async getActionName(){try{if(1==this.isLink){var e=Array.from(u().encode("GroundAction","gb2312")),t=e.length,a=t+2,s=[];s[0]=255,s[1]=255,s[2]=a,s[3]=26;var o=a+26;for(let a=0;a<t;a++)s.push(e[a]),o+=e[a];o%=256,s.push(o);var n=new Uint8Array(s);const d=this.port.writable.getWriter();await d.write(n);const f=await this.port.readable.getReader();var i=[],r=!1;while(!r){const{value:e,done:t}=await f.read();if(t){f.releaseLock();break}for(let a=0;a<e.length;a++)i[i.length]=e[a];for(let a=0;a<i.length;a++)if(255==i[a]&&255==i[a+1]&&4==i[a+2]&&250==i[a+3]&&79==i[a+4]&&75==i[a+5]&&152==i[a+6]){r=!0,i.slice(a,6);break}}var l=[];for(let e=0;e<i.length;e++)if(255==i[e]&&255==i[e+1]&&255!=i[e+2]&&26==i[e+3]){var c=i[e+2],h=[];for(let t=0;t<c-2;t++)h.push(i[e+4+t]);e=e+2+c;var p="地面::"+u().decode(h,"gb2312");l.push(p)}e=Array.from(u().encode("VolleyAction","gb2312")),t=e.length,a=t+2,s=[],s[0]=255,s[1]=255,s[2]=a,s[3]=26,o=a+26;for(let a=0;a<t;a++)s.push(e[a]),o+=e[a];o%=256,s.push(o),n=new Uint8Array(s),await d.write(n),i=[],r=!1;while(!r){const{value:e,done:t}=await f.read();if(t){f.releaseLock();break}for(let a=0;a<e.length;a++)i[i.length]=e[a];for(let a=0;a<i.length;a++)if(255==i[a]&&255==i[a+1]&&4==i[a+2]&&250==i[a+3]&&79==i[a+4]&&75==i[a+5]&&152==i[a+6]){r=!0,i.slice(a,6);break}}for(let e=0;e<i.length;e++)if(255==i[e]&&255==i[e+1]&&255!=i[e+2]&&26==i[e+3]){c=i[e+2],h=[];for(let t=0;t<c-2;t++)h.push(i[e+4+t]);e=e+2+c;p="凌空::"+u().decode(h,"gb2312");l.push(p)}await d.releaseLock(),await f.releaseLock(),this.vOpentions=l}}catch(d){console.error(d)}},async getAction(){try{if(1==this.isLink&&""!=this.selectedOption){var e=this.selectedOption.substring(0,4),t=this.selectedOption.substring(4);"地面::"==e?e="GroundAction/":"凌空::"==e&&(e="VolleyAction/"),t=e+t;var a=Array.from(u().encode(t,"gb2312")),s=a.length,o=s+3,n=[];n[0]=255,n[1]=255,n[2]=o,n[3]=22,n[4]=59;var i=o+22+59;for(let e=0;e<s;e++)n.push(a[e]),i+=a[e];i%=256,n.push(i);var r=new Uint8Array(n);const d=this.port.writable.getWriter();await d.write(r);const f=await this.port.readable.getReader();var l=[],c=!1;while(!c){const{value:e,done:t}=await f.read();if(t){f.releaseLock();break}for(let a=0;a<e.length;a++)l[l.length]=e[a];for(let a=0;a<l.length;a++)if(255==l[a]&&255==l[a+1]&&4==l[a+2]&&250==l[a+3]&&79==l[a+4]&&75==l[a+5]&&152==l[a+6]){c=!0,l.slice(a,6);break}}for(let e=0;e<l.length;e++)if(255==l[e]&&255==l[e+1]&&255!=l[e+2]&&22==l[e+3]){var h=l[e+2],p=[];for(let t=0;t<h-2;t++)p.push(l[e+4+t]);e=e+2+h,console.log(p)}await d.releaseLock(),await f.releaseLock()}}catch(d){console.error(d)}}}};const Y=(0,d.Z)(j,[["render",q]]);var $=Y;const K=(0,s._)("h3",null,"大黄蜂机器人通讯结构",-1),J=(0,s._)("p",null,"连接方式 : 串口",-1),Q=(0,s._)("p",null,"配置参数baudRate : 115200",-1),X=(0,s._)("p",null,"配置参数parity : 0",-1),ee=(0,s._)("p",null,"配置参数dataBits : 8",-1),te=(0,s._)("p",null,"配置参数stopBits : 1",-1),ae=(0,s._)("p",null,"配置参数bufferSize : 4096",-1),se=(0,s._)("label",null,[(0,s.Uk)(" 连接成功后，发送[0xFF, 0xFF, 0x02, 0xF5, 0xF7] 指令0xF5是进入PC编程模式 0xF7是(指令+数据)和%256的结果 "),(0,s._)("br"),(0,s.Uk)(" 发送后接收数据直到接收[0xFF,0xFF,0x04 0xF4,0x4F 0x4B,0x93] 当中的数据需要进行处理")],-1),oe=(0,s._)("p",null,null,-1),ne=(0,s._)("p",null,null,-1),ie=(0,s._)("label",null,"下载是将pc上的数据载入到机器人当中，这里用一个.shr机器人保存再本地的文件开始,下载的指令顺序是:删除(0x07),创建(0X06),下载(0x02)",-1),re=(0,s._)("p",null,null,-1);function le(e,t,a,o,n,i){const r=(0,s.up)("el-button");return(0,s.wg)(),(0,s.iD)(s.HY,null,[K,J,Q,X,ee,te,ae,(0,s.Wm)(r,{type:"primary",onClick:t[0]||(t[0]=e=>i.requestSerialPort())},{default:(0,s.w5)((()=>[(0,s.Uk)("连接")])),_:1}),se,oe,(0,s._)("input",{type:"file",onChange:t[1]||(t[1]=(...e)=>i.actionDownload&&i.actionDownload(...e))},null,32),ne,ie,re],64)}var ce={data(){return{port:{},isLink:!1,initData:[],dataArr:[]}},methods:{async requestSerialPort(){try{const o=await navigator.serial.requestPort();if(null!=o){await o.open({baudRate:115200,dataBits:8,stopBits:1,bufferSize:4096}),this.port=o;const n=new Uint8Array([255,255,2,245,247]),i=o.writable.getWriter();await i.write(n),await i.releaseLock();const r=await o.readable.getReader();this.isLink=!1;var e=[];while(1){if(1==this.isLink){r.releaseLock();break}const{value:s,done:o}=await r.read();if(o){r.releaseLock();break}for(let t=0;t<s.length;t++)e[e.length]=s[t];for(let n=0;n<e.length;n++)if(255==e[n]&&255==e[n+1]){var t=e[n+2],a=e[n+3];if(4==t&&245==a&&79==e[n+4]&&75==e[n+5]&&e[n+6]==(t+a+79+75)%256){this.isLink=!0;break}}}let l=0;for(let o=0;o<e.length;o++)if(255==e[o]&&255==e[o+1]){t=e[o+2],a=e[o+3];if(50==t&&245==a){var s=[];for(let t=0;t<48;t++)s[t]=e[o+t+4];o+=52,this.initData[l]=s,l++}}console.log(this.initData)}}catch(o){console.error(o)}},async actionDownload(e){try{const t=e.target.files[0],a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=async e=>{const t=e.target.result,a=t.trim().split("\n").length;this.dataArr=[];for(let u=0;u<a;u++){const e=t.split("\r\n")[u].split(",")[0],a=e.split(/\s+/).map((e=>isNaN(e)?e:""==e?" ":Number(e)));this.dataArr.push(a)}if(1==this.isLink){var s=[],o=[],n=this.dataArr,i=n.length;for(let t=0;t<i;t++){var r=!1;" "==n[t][0]&&(r=!0),253==n[t][0]&&253==n[t][1]&&254==n[t][2]&&" "!=n[t][3]&&s.push(n[t][3]),1==r&&o.push(n[t])}var l=0;i=o.length;var c=[];for(let t=0;t<i;t++){var h=o[t][5],p=o[t][6],d=o[t][7],f=o[t][8],g=o[t][9],m=o[t][10];for(let e=0;e<8;e++){let a=h&Math.pow(2,7-e);0!=a&&(o[t][e+11]*=-1)}for(let e=0;e<8;e++){let a=p&Math.pow(2,7-e);0!=a&&(o[t][e+19]*=-1)}for(let e=0;e<8;e++){let a=d&Math.pow(2,7-e);0!=a&&(o[t][e+27]*=-1)}for(let e=0;e<8;e++){let a=f&Math.pow(2,7-e);0!=a&&(o[t][e+35]*=-1)}for(let e=0;e<8;e++){let a=g&Math.pow(2,7-e);0!=a&&(o[t][e+43]*=-1)}for(let e=0;e<8;e++){let a=m&Math.pow(2,7-e);0!=a&&(o[t][51]*=-1)}var v=0,w=!1,_=!1;0!=o[t][4]&&o[t][4]>128?v=o[t][4]-128:0!=o[t][4]&&o[t][4]>128?(v=o[t][4],w=!1,_=!0):0==o[t][4]&&(w=!1,_=!1);var b=[],P=o[t][3];for(let e=0;e<48;e++)b[e]=o[t][e+11];var y=o[t][59],k=o[t][60],D=0,S=-1,F=-1;251!=o[t][61]&&251!=o[t][62]&&252!=o[t][61]&&252!=o[t][62]?(F=256*o[t][61]+o[t][62],D=2):251==o[t][61]&&251==o[t][62]?D=4:252==o[t][61]&&252==o[t][62]&&(D=3),S=F,0!=o[t][4]&&(w=0==l,o[t][4]<128?(_=!0,v=o[t][4]):(_=!1,v=o[t][4]-128)),l=o[t][4]>128?o[t][4]:0;var L={number:P,Name:1,Pos:b,Speed:y,Delay:k,Loop_Time:v,Is_Loop_Start:w,Is_Loop_End:_,Music_State:D,Music_Number:S};c.push(z(L))}if(console.log(c),0==this.isLink)return;i=c.length;let e=0;v=-1;var M=!1,I=[[]],A=c[0].number;I[0]=[];for(let t=0;t<i;t++){A!=c[t].number&&(A=c[t].number,e++,I[e]=[]);var N=[];N.push(255),N.push(255),N.push(61),N.push(2),M||(N[4]=0),!M||c[t].Is_Loop_Start||c[t].Is_Loop_End||(N[4]=v+128),c[t].Is_Loop_End&&(M=!1,N[4]=v,v=0),c[t].Is_Loop_Start&&(M=!0,v=c[t].Loop_Time,N[4]=v+128);var x=0,C=0,T=0,U=0,B=0,E=0;for(let e=0;e<48;e++)e<8&&c[t].Pos[e]<0&&(x+=parseInt(Math.pow(2,7-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=8&&e<16&&c[t].Pos[e]<0&&(C+=parseInt(Math.pow(2,15-e)),c[t].Pos[e]=-1*c[t].pos[e]),e>=16&&e<24&&c[t].Pos[e]<0&&(T+=parseInt(Math.pow(2,23-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=24&&e<32&&c[t].Pos[e]<0&&(U+=parseInt(Math.pow(2,31-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=32&&e<40&&c[t].Pos[e]<0&&(B+=parseInt(Math.pow(2,39-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=40&&e<48&&c[t].Pos[e]<0&&(E+=parseInt(Math.pow(2,47-e)),c[t].Pos[e]=-1*c[t].Pos[e]);N[5]=x,N[6]=C,N[7]=T,N[8]=U,N[9]=B,N[10]=E;for(let e=0;e<48;e++)N[e+11]=c[t].Pos[e];switch(N[59]=c[t].Speed,N[60]=c[t].Delay,c[t].Music_State){case 1:N[61]=parseInt(c[t].Music_Number/256),N[62]=parseInt(c[t].Music_Number%256);break;case 2:N[61]=parseInt(c[t].Music_Number/256),N[62]=parseInt(c[t].Music_Number%256);break;case 3:N[61]=252,N[62]=252;break;case 4:N[61]=251,N[62]=251;break}var O=0;for(let e=2;e<63;e++)O+=N[e];O%=256,N[63]=O,I[e].push(N)}i=s.length,console.log(I);for(let t=0;t<i;t++){let e=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await e;var R=s[t],W=Array.from(u().encode(R,"utf8")),G=W.length,V=G+2,Z=[];O=0;Z[0]=255,Z[1]=255,Z[2]=V,Z[3]=7,O=V+7;for(let t=0;t<G;t++)Z.push(W[t]),O+=W[t];O%=256,Z.push(O);var q=new Uint8Array(Z);const a=this.port.writable.getWriter();await a.write(q);const o=await this.port.readable.getReader();let n=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await n,Z[3]=6,Z[Z.length-1]=Z[Z.length-1]-1,q=new Uint8Array(Z),await a.write(q),[],!1;let i=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await i;for(let s=0;s<I[t].length;s++){let e=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await e;const o=new Uint8Array(I[t][s]);console.log(o),await a.write(o),[],!1}await a.releaseLock(),await o.releaseLock()}console.log("上传完成")}}}catch(t){}}}};const he=(0,d.Z)(ce,[["render",le]]);var ue=he;const pe=(0,s._)("h3",null,"钢索机器人通讯结构",-1),de=(0,s._)("p",null,"连接方式 ： HID(usb口的一种方式)",-1),fe=(0,s._)("p",null,"匹配VendorID ： 0x0483",-1),ge=(0,s._)("p",null,"匹配ProductID ： 0x5750",-1),me=(0,s._)("label",null,"连接成功后发送[0xFF, 0x02, 0xF5, 0xF7]读取数据直到获取到[4F 4B](OK)后接收结束",-1),ve=(0,s._)("p",null,null,-1),we=(0,s._)("label",null,"关闭需要发送指令 [ 0xFF, 0x02, 0xF6, 0xF8] 然后断开HID",-1),_e=(0,s._)("p",null,null,-1),be=(0,s._)("label",null,"例如左胯:",-1),Pe=(0,s._)("label",null,"控制舵机移动[0xFF,数据长度,指令(0x01),数据(位置+速度),sum和]指定左肩的下标控制",-1),ye=(0,s._)("p",null,null,-1),ke=(0,s._)("p",null,null,-1),De=(0,s._)("h4",null,"上传功能",-1),Se=(0,s._)("label",null,"读取机器人内部的动作文件名",-1),Fe=(0,s._)("p",null,null,-1);function Le(e,t,a,o,n,i){const r=(0,s.up)("el-button"),l=(0,s.up)("el-input");return(0,s.wg)(),(0,s.iD)(s.HY,null,[pe,de,fe,ge,(0,s.Wm)(r,{type:"primary",onClick:t[0]||(t[0]=e=>i.requestSerialPort())},{default:(0,s.w5)((()=>[(0,s.Uk)("连接")])),_:1}),me,ve,(0,s.Wm)(r,{type:"primary",onClick:t[1]||(t[1]=e=>i.closeMessage())},{default:(0,s.w5)((()=>[(0,s.Uk)("关闭")])),_:1}),we,_e,(0,s.Wm)(r,{onClick:t[2]||(t[2]=e=>i.timeSendingPosition())},{default:(0,s.w5)((()=>[(0,s.Uk)("时时发送位置")])),_:1}),be,(0,s.Wm)(l,{modelValue:n.ArmInput,"onUpdate:modelValue":t[3]||(t[3]=e=>n.ArmInput=e),style:{width:"50px"}},null,8,["modelValue"]),Pe,ye,(0,s._)("input",{type:"file",onChange:t[4]||(t[4]=(...e)=>i.actionDownload&&i.actionDownload(...e))},null,32),(0,s.Uk)(" 下载功能 "),ke,De,Se,Fe,(0,s.Wm)(r,{type:"primary",onClick:t[5]||(t[5]=e=>i.getActionName())},{default:(0,s.w5)((()=>[(0,s.Uk)("读取")])),_:1})],64)}class Me{constructor({number:e,Name:t,Pos:a,Speed:s,Delay:o,Loop_Time:n,Is_Loop_Start:i,Is_Loop_End:r,Music_State:l,Music_Number:c,Is_Cur_Form:h}){this.number=e,this.Name=t,this.Pos=a,this.Speed=s,this.Delay=o,this.Loop_Time=n,this.Is_Loop_Start=i,this.Is_Loop_End=r,this.Music_State=l,this.Music_Number=c,this.Is_Cur_Form=h}}function Ie(e){return new Me({number:e.number,Name:e.Name,Pos:e.Pos,Speed:e.Speed,Delay:e.Delay,Loop_Time:e.Loop_Time,Is_Loop_Start:e.Is_Loop_Start,Is_Loop_End:e.Is_Loop_End,Music_State:e.Music_State,Music_Number:e.Music_Number,Is_Cur_Form:e.Is_Cur_Form})}var Ae={data(){return{initData:[],isInitData:!1,endpointNumber:2,isLink:!1,hidDevice:[],dataArr:[],ArmInput:0,isRedActionLoong:!1,isRedActionRobot:!1,actionList:[]}},methods:{async requestSerialPort(){try{await navigator.hid.requestDevice({filters:[{vendorId:1155,productId:22352}]}).then((async e=>{await e[0].open(),this.hidDevice=e[0],e[0].addEventListener("inputreport",this.receivingProcess),this.initData=[],this.isInitData=!1;var t=new Uint8Array([255,2,245,247]);await e[0].sendReport(0,t)})).catch((e=>{console.error(e)}))}catch(e){console.log(e)}},async closeMessage(){if(1==this.isLink){var e=new Uint8Array([255,2,246,248]);await this.hidDevice.sendReport(0,e)}},async actionDownload(e){var t=e.target.files[0],a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=async e=>{const t=e.target.result,a=t.trim().split("\n").length;this.dataArr=[];for(let u=0;u<a;u++){const e=t.split("\r\n")[u].split(",")[0],a=e.split(/\s+/).map((e=>isNaN(e)?e:""==e?" ":Number(e)));this.dataArr.push(a)}{var s=[],o=[],n=this.dataArr,i=n.length;for(let t=0;t<i;t++){var r=!1;" "==n[t][0]&&(r=!0),253==n[t][0]&&253==n[t][1]&&254==n[t][2]&&" "!=n[t][3]&&s.push(n[t][3]),1==r&&o.push(n[t])}var l=0;i=o.length;var c=[];for(let t=0;t<i;t++){var h=o[t][5],p=o[t][6],d=o[t][7],f=o[t][8],g=o[t][9],m=o[t][10];for(let e=0;e<8;e++){let a=h&Math.pow(2,7-e);0!=a&&(o[t][e+11]*=-1)}for(let e=0;e<8;e++){let a=p&Math.pow(2,7-e);0!=a&&(o[t][e+19]*=-1)}for(let e=0;e<8;e++){let a=d&Math.pow(2,7-e);0!=a&&(o[t][e+27]*=-1)}for(let e=0;e<8;e++){let a=f&Math.pow(2,7-e);0!=a&&(o[t][e+35]*=-1)}for(let e=0;e<8;e++){let a=g&Math.pow(2,7-e);0!=a&&(o[t][e+43]*=-1)}for(let e=0;e<8;e++){let a=m&Math.pow(2,7-e);0!=a&&(o[t][e+51]*=-1)}var v=0,w=!1,_=!1;0!=o[t][4]&&o[t][4]>128?v=o[t][4]-128:0!=o[t][4]&&o[t][4]<128?(v=o[t][4],w=!1,_=!0):0==o[t][4]&&(w=!1,_=!1);var b=[],P=o[t][3];for(let e=0;e<48;e++)b[e]=o[t][e+11];var y=o[t][59],k=o[t][60],D=0,S=-1,F=-1,L=0,M=o[t].length-2;63==M?(251!=o[t][61]&&251!=o[t][62]&&252!=o[t][61]&&252!=o[t][62]?(F=256*o[t][61]+o[t][62],D=2):251==o[t][61]&&251==o[t][62]?D=4:252==o[t][61]&&252==o[t][62]&&(D=3),S=F):61==M&&(F=0,D=2),L=o[t][o[t].length-2],S=F,0!=o[t][4]&&(w=0==l,o[t][4]<128?(_=!0,v=o[t][4]):(_=!1,v=o[t][4]-128)),l=o[t][4]>128?o[t][4]:0;var I={number:P,Name:1,Pos:b,Speed:y,Delay:k,Loop_Time:v,Is_Loop_Start:w,Is_Loop_End:_,Music_State:D,Music_Number:S,Is_Cur_Form:L};c.push(Ie(I))}i=c.length;let e=0;v=-1;var A=!1,N=[[]],x=c[0].number;N[0]=[];for(let t=0;t<i;t++){x!=c[t].number&&(x=c[t].number,e++,N[e]=[]);var C=[];C.push(255),C.push(62),C.push(2),A||(C[3]=0),!A||c[t].Is_Loop_Start||c[t].Is_Loop_End||(C[3]=v+128),c[t].Is_Loop_End&&(A=!1,C[3]=v,v=0),c[t].Is_Loop_Start&&(A=!0,v=c[t].Loop_Time,C[3]=v+128);var T=0,U=0,B=0,E=0,O=0,R=0;for(let e=0;e<48;e++)e<8&&c[t].Pos[e]<0&&(T+=parseInt(Math.pow(2,7-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=8&&e<16&&c[t].Pos[e]<0&&(U+=parseInt(Math.pow(2,15-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=16&&e<24&&c[t].Pos[e]<0&&(B+=parseInt(Math.pow(2,23-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=24&&e<32&&c[t].Pos[e]<0&&(E+=parseInt(Math.pow(2,31-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=32&&e<40&&c[t].Pos[e]<0&&(O+=parseInt(Math.pow(2,39-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=40&&e<48&&c[t].Pos[e]<0&&(R+=parseInt(Math.pow(2,47-e)),c[t].Pos[e]=-1*c[t].Pos[e]);C[4]=T,C[5]=U,C[6]=B,C[7]=E,C[8]=O,C[9]=R;for(let e=0;e<48;e++)C[e+10]=c[t].Pos[e];switch(C[58]=c[t].Speed,C[59]=c[t].Delay,c[t].Music_State){case 1:C[60]=parseInt(c[t].Music_Number/256),C[61]=parseInt(c[t].Music_Number%256);break;case 2:C[60]=parseInt(c[t].Music_Number/256),C[61]=parseInt(c[t].Music_Number%256);break;case 3:C[60]=252,C[61]=252;break;case 4:C[60]=251,C[61]=251;break}C[62]=c[t].Is_Cur_Form;var W=0,G=C.length;for(let e=1;e<G;e++)W+=C[e];W%=256,C[63]=W,N[e].push(C)}console.log(N),i=s.length;for(let t=0;t<i;t++){let e=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await e;var V=s[t],Z=V.substring(0,3),q=V.substring(3);"人型:"==Z?Z="RobotAction/":"龙型:"==Z&&(Z="Action/"),q=Z+q+".sh";var H=Array.from(u().encode(q,"utf8")),z=H.length,j=z+2,Y=[];Y[0]=255,Y[1]=j,Y[2]=21;W=j+21;for(let t=0;t<z;t++)Y.push(H[t]),W+=H[t];W%=256,Y.push(W);var $=new Uint8Array(Y);await this.hidDevice.sendReport(0,$);let a=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await a,Y[2]=20,Y[Y.length-1]=Y[Y.length-1]-1,$=new Uint8Array(Y),await this.hidDevice.sendReport(0,$);let o=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await o;for(let s=0;s<N[t].length;s++){let e=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await e;var K=new Uint8Array(N[t][s]);console.log(K),await this.hidDevice.sendReport(0,K)}}}}},async timeSendingPosition(){try{if(1==this.isLink){var e=[];for(let t=0;t<this.initData[0].length;t++)e.push(this.initData[0][t]);e[0]+=parseInt(this.ArmInput),e.push(35);var t=[];t[0]=255,t[1]=51,t[2]=1;var a=52;for(let s=0;s<e.length;s++)t[3+s]=e[s],a+=e[s];a%=256,t[t.length]=a;var s=new Uint8Array(t);console.log(s),await this.hidDevice.sendReport(0,s)}}catch(o){console.error(o)}},async getActionName(){try{if(1==this.isLink){var e=[];e[0]=255,e[1]=2,e[2]=14,e[3]=16,this.isRedActionLoong=!0,await this.hidDevice.sendReport(0,e)}}catch(t){console.error(t)}},async receivingProcess(e){try{const{data:l}=e,c=new Uint8Array(l.buffer);console.log(c);var t=c.length;for(let e=0;e<t;e++)if(255==c[e]&&255==c[e+1]){var a=c[e+2],s=c[e+3];if(50==a&&245==s){var o=[];for(let t=0;t<48;t++)o[t]=c[e+t+4];this.initData.push(o)}else if(4==a&&245==s&&79==c[e+4]&&75==c[e+5])this.isLink=!0,this.isInitData=!0,console.log("isInitData = "+this.isInitData);else if(4==a&&246==s&&79==c[e+4]&&75==c[e+5])this.isLink=!1,this.hidDevice.close();else if(14==s){var n=s+a,i=[];for(let e=0;t<a-1;e++)n+=c[4+e],i.push(c[4+e]);n%256==c[4+n]&&actionList.push("龙型:"+u().decode(i,"gb2312"))}else if(4==a&&250==s&&79==c[e+4]&&75==c[e+5]&&152==c[e+6]&&1==this.isRedActionLoong){this.isRedActionLoong;conv.encode("RobotAction","gb2312");var r=[];r[0]=255,r[1]=2,r[2]=14,r[3]=16,this.isRedActionLoong=!0,await this.hidDevice.sendReport(0,r)}}}catch(l){console.log(l)}}}};const Ne=(0,d.Z)(Ae,[["render",Le]]);var xe=Ne;const Ce=(0,s._)("p",null,null,-1);var Te={__name:"Bluetooth",setup(e){let t,a;var o=[],n=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];async function i(){try{const e={filters:[{namePrefix:"QTZM-"}],optionalServices:[65472]};t=await navigator.bluetooth.requestDevice(e),a=await t.gatt.connect(),await new Promise((e=>setTimeout(e,1e3)));const s=await a.getPrimaryServices(65472);console.log(s),o=await s[0].getCharacteristic(65473),console.log(o),o.startNotifications(),o.addEventListener("characteristicvaluechanged",r),!0}catch(e){console.error("连接设备出错:",e),!1}}async function r(e){console.log(e)}async function l(e){var t=[],a=65535,s=[];t.push(85),t.push(170);var i=e.length+3;t.push(i>>8&255),s.push(i>>8&255),t.push(255&i),s.push(255&i);for(let o=0;o<e.length;o++)t.push(e[o]),s.push(e[o]);for(let o of s)a=a>>8^n[255&(a^o)];t.push(a>>8&255),t.push(255&a);var r=0;for(let o=0;o<t.length;o++)r+=t[o];t.push(255&r),console.log(new Uint8Array(t)),await o.writeValue(new Uint8Array(t))}async function c(){var e=[19,225];l(e)}return(e,t)=>{const a=(0,s.up)("el-button");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(a,{onClick:i},{default:(0,s.w5)((()=>[(0,s.Uk)("连接蓝牙设备")])),_:1}),Ce,(0,s.Wm)(a,{onClick:c},{default:(0,s.w5)((()=>[(0,s.Uk)("进入小剧场")])),_:1})],64)}}};const Ue=Te;var Be=Ue;const Ee=(0,s._)("p",null,null,-1),Oe=(0,s._)("p",null,null,-1),Re=(0,s._)("table",null," 单独控制:进入编程模式 > 接收进入编程模式完成后 > 发送动作帧 > 退出编程模式 ",-1),We=(0,s._)("p",null,null,-1),Ge=(0,s._)("p",null,null,-1);function Ve(e,t,a,o,n,i){const r=(0,s.up)("el-button"),l=(0,s.up)("el-option"),c=(0,s.up)("el-select"),h=(0,s.up)("el-input");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(r,{onClick:i.connectToDevice},{default:(0,s.w5)((()=>[(0,s.Uk)("连接蓝牙设备(大黄蜂)")])),_:1},8,["onClick"]),Ee,(0,s.Wm)(r,{onClick:i.UploadActionFileNames},{default:(0,s.w5)((()=>[(0,s.Uk)("上传动作文件名")])),_:1},8,["onClick"]),(0,s.Wm)(c,{modelValue:n.selectedOption,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedOption=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.vOpentions,(e=>((0,s.wg)(),(0,s.j4)(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,s.Wm)(r,{onClick:i.performDance},{default:(0,s.w5)((()=>[(0,s.Uk)("播放动作")])),_:1},8,["onClick"]),Oe,Re,We,(0,s.Wm)(r,{onClick:i.InProgrammingMode},{default:(0,s.w5)((()=>[(0,s.Uk)("进入编程模式")])),_:1},8,["onClick"]),(0,s.Wm)(h,{modelValue:n.ArmInput,"onUpdate:modelValue":t[1]||(t[1]=e=>n.ArmInput=e),style:{width:"50px"}},null,8,["modelValue"]),(0,s.Wm)(r,{onClick:i.ControlJoints},{default:(0,s.w5)((()=>[(0,s.Uk)("实时位置")])),_:1},8,["onClick"]),Ge,(0,s._)("input",{type:"file",onChange:t[2]||(t[2]=(...e)=>i.actionDownload&&i.actionDownload(...e))},null,32),(0,s.Uk)(" 下载 ")],64)}a(2801);var Ze={data(){return{device:[],server:[],isLink:!1,characteristic:[],Crc16_Table:[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448],vOpentions:[],vOpentionsList:[],selectedOption:"",isOpention:!1,isProgramme:!1,progData:[],ArmInput:0,sendPosData:[[]],sendPosDataNames:[],isSendPosData:!1,isSendPdFlag:0,isSendPdFlagEach:0}},methods:{async connectToDevice(){try{const e={filters:[{namePrefix:"DHF"}],optionalServices:[65472]};await navigator.bluetooth.requestDevice(e).then((async e=>{this.device=e,console.log(this.device),this.server=await this.device.gatt.connect(),await new Promise((e=>setTimeout(e,1e3)));const t=await this.server.getPrimaryServices(65472);this.characteristic=await t[0].getCharacteristic(65473),this.characteristic.startNotifications(),this.characteristic.addEventListener("characteristicvaluechanged",this.ReadDataMessage),this.isLink=!0}))}catch(e){e instanceof DOMException&&e.code===DOMException.NOT_FOUND_ERR?(this.isLink=!1,console.error("连接设备出错:",e)):(console.error("连接设备出错:",e),this.isLink=!1)}},async ReadDataMessage(e){const t=new Uint8Array(e.target.value.buffer);console.log(t);var a=t.length;for(let v=0;v<a;v++)if(85==t[v]&&170==t[v+1]){var s=t[v+2],o=t[v+3],n=s<<8|o,i=t[v+4],r=t[v+5];if(19==i&&16==r){var l=t[v+3+n-2],c=t[v+3+n-1],h=l<<8|c,p=65535;for(let e=0;e<n-1;e++)p=p>>8^this.Crc16_Table[255&(p^t[v+2+e])];if(p==h){var d=[];for(let e=0;e<n-3-2;e++)d.push(t[v+6+e]);this.addVoptions(u().decode(d,"GB18030"))}}else if(19==i&&250==r&&250==t[v+6])this.isOpention&&(this.isOpention=!1,console.log(this.vOpentions));else if(19==i&&230==r)if(230==t[v+6]&&6==n)this.isProgramme=!0,console.log(this.progData);else{l=t[v+3+n-2],c=t[v+3+n-1],h=l<<8|c,p=65535;for(let e=0;e<n-1;e++)p=p>>8^this.Crc16_Table[255&(p^t[v+2+e])];if(p==h){d=[];for(let e=0;e<n-3-2;e++)d.push(t[v+6+e]);this.progData.push(d)}}else if(19==i&&220==r&&79==t[v+6]&&75==t[v+7]){e=this.sendPosData[this.isSendPdFlag][0];console.log("第"+this.isSendPdFlag+"个动作文件创建成功，发送首帧"),this.SendDataFormatMessage(e)}else if(19==i&&227==r&&79==t[v+6]&&75==t[v+7]){a=this.sendPosData[this.isSendPdFlag].length;if(a-1==this.isSendPdFlagEach){if(this.isSendPdFlag=this.isSendPdFlag+1,this.sendPosDataNames.length==this.isSendPdFlag)console.log("动作文件发送完成"),this.isSendPosData=!1;else if(this.isSendPdFlag<this.sendPosDataNames.length){this.isSendPdFlagEach=0;var f=this.sendPosDataNames[this.isSendPdFlag],g=this.nameDataDispose(f),m=[];m=[];m.push(19),m.push(220);for(let e=0;e<g.length;e++)m.push(g[e]);console.log("发送第"+this.isSendPdFlag+"个动作文件"),this.SendDataFormatMessage(m)}}else{this.isSendPdFlagEach=this.isSendPdFlagEach+1;e=this.sendPosData[this.isSendPdFlag][this.isSendPdFlagEach];console.log("发送第"+this.isSendPdFlagEach+"帧"),this.SendDataFormatMessage(e)}}}},async SendDataFormatMessage(e){var t=[],a=65535,s=[];t.push(85),t.push(170);var o=e.length+3;t.push(o>>8&255),s.push(o>>8&255),t.push(255&o),s.push(255&o);for(let i=0;i<e.length;i++)t.push(e[i]),s.push(e[i]);for(let i of s)a=a>>8^this.Crc16_Table[255&(a^i)];t.push(a>>8&255),t.push(255&a);var n=0;for(let i=0;i<t.length;i++)n+=t[i];t.push(255&n),await this.characteristic.writeValue(new Uint8Array(t))},async Advance(){var e=[19,1];this.SendDataFormatMessage(e)},async UploadActionFileNames(){if(this.isLink){var e=[19,16];this.isOpention=!0,this.vOpentions=[],this.vOpentionsList=[],this.SendDataFormatMessage(e)}},addVoptions(e){this.vOpentions.push(e)},async performDance(){if(this.isLink&&""!=this.selectedOption){var e=Array.from(u().encode("Action/"+this.selectedOption,"GB18030")),t=[];t.push(19),t.push(23);for(let a=0;a<e.length;a++)t.push(e[a]);this.SendDataFormatMessage(t)}},async InProgrammingMode(){if(console.log(11),this.isLink){console.log(2);var e=[];e.push(19),e.push(230),this.isProgramme=!1,this.SendDataFormatMessage(e)}},async ControlJoints(){var e=[3,19,255,255,57,241,22,72,9,0,0,0,20,0,0,2,12,35,5,0,0,4,0,43,4,91,65,0,0,0,0,0,85,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,10,14];this.SendDataFormatMessage(e)},async actionDownload(e){try{const t=e.target.files[0],a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=async e=>{const t=e.target.result,a=t.trim().split("\n").length;this.dataArr=[];for(let W=0;W<a;W++){const e=t.split("\r\n")[W].split(",")[0],a=e.split(/\s+/).map((e=>isNaN(e)?e:""==e?" ":Number(e)));this.dataArr.push(a)}if(1==this.isLink&&0==this.isSendPosData){this.isSendPosData=!0,this.sendPosData=[[]],this.isSendPdFlag=0,this.isSendPdFlagEach=0;var s=[],o=[],n=this.dataArr,i=n.length;for(let t=0;t<i;t++){var r=!1;" "==n[t][0]&&(r=!0),253==n[t][0]&&253==n[t][1]&&254==n[t][2]&&" "!=n[t][3]&&s.push(n[t][3]),1==r&&o.push(n[t])}var l=0;i=o.length;var c=[];for(let t=0;t<i;t++){var h=o[t][5],u=o[t][6],p=o[t][7],d=o[t][8],f=o[t][9],g=o[t][10];for(let e=0;e<8;e++){let a=h&Math.pow(2,7-e);0!=a&&(o[t][e+11]*=-1)}for(let e=0;e<8;e++){let a=u&Math.pow(2,7-e);0!=a&&(o[t][e+19]*=-1)}for(let e=0;e<8;e++){let a=p&Math.pow(2,7-e);0!=a&&(o[t][e+27]*=-1)}for(let e=0;e<8;e++){let a=d&Math.pow(2,7-e);0!=a&&(o[t][e+35]*=-1)}for(let e=0;e<8;e++){let a=f&Math.pow(2,7-e);0!=a&&(o[t][e+43]*=-1)}for(let e=0;e<8;e++){let a=g&Math.pow(2,7-e);0!=a&&(o[t][51]*=-1)}var m=0,v=!1,w=!1;0!=o[t][4]&&o[t][4]>128?m=o[t][4]-128:0!=o[t][4]&&o[t][4]>128?(m=o[t][4],v=!1,w=!0):0==o[t][4]&&(v=!1,w=!1);var _=[],b=o[t][3];for(let e=0;e<48;e++)_[e]=o[t][e+11];var P=o[t][59],y=o[t][60],k=0,D=-1,S=-1;251!=o[t][61]&&251!=o[t][62]&&252!=o[t][61]&&252!=o[t][62]?(S=256*o[t][61]+o[t][62],k=2):251==o[t][61]&&251==o[t][62]?k=4:252==o[t][61]&&252==o[t][62]&&(k=3),D=S,0!=o[t][4]&&(v=0==l,o[t][4]<128?(w=!0,m=o[t][4]):(w=!1,m=o[t][4]-128)),l=o[t][4]>128?o[t][4]:0;var F={number:b,Name:1,Pos:_,Speed:P,Delay:y,Loop_Time:m,Is_Loop_Start:v,Is_Loop_End:w,Music_State:k,Music_Number:D};c.push(z(F))}this.sendPosDataNames=s,i=c.length;let e=0;m=-1;var L=!1,M=[[]],I=c[0].number;M[0]=[];for(let t=0;t<i;t++){I!=c[t].number&&(I=c[t].number,e++,M[e]=[]);var A=[];A.push(19),A.push(227),L||(A[2]=0),!L||c[t].Is_Loop_Start||c[t].Is_Loop_End||(A[2]=m+128),c[t].Is_Loop_End&&(L=!1,A[2]=m,m=0),c[t].Is_Loop_Start&&(L=!0,m=c[t].Loop_Time,A[2]=m+128);var N=0,x=0,C=0,T=0,U=0,B=0;for(let e=0;e<48;e++)e<8&&c[t].Pos[e]<0&&(N+=parseInt(Math.pow(2,7-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=8&&e<16&&c[t].Pos[e]<0&&(x+=parseInt(Math.pow(2,15-e)),c[t].Pos[e]=-1*c[t].pos[e]),e>=16&&e<24&&c[t].Pos[e]<0&&(C+=parseInt(Math.pow(2,23-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=24&&e<32&&c[t].Pos[e]<0&&(T+=parseInt(Math.pow(2,31-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=32&&e<40&&c[t].Pos[e]<0&&(U+=parseInt(Math.pow(2,39-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=40&&e<48&&c[t].Pos[e]<0&&(B+=parseInt(Math.pow(2,47-e)),c[t].Pos[e]=-1*c[t].Pos[e]);A[3]=N,A[4]=x,A[5]=C,A[6]=T,A[7]=U,A[8]=B;for(let e=0;e<48;e++)A[e+9]=c[t].Pos[e];switch(A[57]=c[t].Speed,A[58]=c[t].Delay,c[t].Music_State){case 1:A[59]=parseInt(c[t].Music_Number/256),A[60]=parseInt(c[t].Music_Number%256);break;case 2:A[59]=parseInt(c[t].Music_Number/256),A[60]=parseInt(c[t].Music_Number%256);break;case 3:A[59]=252,A[60]=252;break;case 4:M[59]=251,M[60]=251;break}M[e].push(A)}console.log(M),this.sendPosData=M;var E=this.sendPosDataNames[0],O=this.nameDataDispose(E),R=[];R.push(19),R.push(220);for(let t=0;t<O.length;t++)R.push(O[t]);console.log("创建首个动作文件"),this.SendDataFormatMessage(R)}}}catch(t){console.error(t)}},nameDataDispose(e){var t="Action/"+e+".sh",a=Array.from(u().encode(t,"GB18030"));return a}}};const qe=(0,d.Z)(Ze,[["render",Ve]]);var He=qe;const ze=(0,s._)("p",null,null,-1),je=(0,s._)("p",null,null,-1),Ye=(0,s._)("p",null,null,-1);function $e(e,t,a,o,n,i){const r=(0,s.up)("el-button"),l=(0,s.up)("el-option"),c=(0,s.up)("el-select");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(r,{onClick:i.connectToDevice},{default:(0,s.w5)((()=>[(0,s.Uk)("连接蓝牙设备(钢锁)")])),_:1},8,["onClick"]),ze,(0,s.Wm)(r,{onClick:i.UploadFileName},{default:(0,s.w5)((()=>[(0,s.Uk)("上传动作名称(龙型,人形两种)")])),_:1},8,["onClick"]),(0,s.Wm)(c,{modelValue:n.selectActionName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectActionName=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.actionNames,(e=>((0,s.wg)(),(0,s.j4)(l,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),(0,s.Wm)(r,{onClick:i.performDance},{default:(0,s.w5)((()=>[(0,s.Uk)("播放动作")])),_:1},8,["onClick"]),je,(0,s._)("input",{type:"file",onChange:t[1]||(t[1]=(...e)=>i.actionDownload&&i.actionDownload(...e))},null,32),(0,s.Uk)(" 下载 "),Ye,(0,s.Wm)(r,{onClick:i.GetMusic},{default:(0,s.w5)((()=>[(0,s.Uk)("获取机器人音乐")])),_:1},8,["onClick"])],64)}var Ke={data(){return{device:[],server:[],isLink:!1,characteristic:[],readDataList:[],actionNames:[],selectActionName:"",isAction:!1,isRobotAction:!1,actionExePorgress:0,isActionExePorgress:!1,sendPosDataNames:[],sendPosData:[[]],isSendPosData:!1,isSendPdFlag:0,isSendPdFlagEach:0,musicFlag:0}},methods:{async connectToDevice(){try{const e={acceptAllDevices:!0,optionalServices:[65504]};await navigator.bluetooth.requestDevice(e).then((async e=>{if(this.device=e,this.server=await this.device.gatt.connect(),await new Promise((e=>setTimeout(e,1e3))),this.server.connected){const e=await this.server.getPrimaryServices(65504);this.characteristic=await e[0].getCharacteristic(65505),this.characteristic.startNotifications(),this.characteristic.addEventListener("characteristicvaluechanged",this.ReadDataMessage),this.isLink=!0;var t=[];t.push(15),this.SendDataFormatMessage(t),console.log("连接成功")}else console.log("连接失败")}))}catch(e){e instanceof DOMException&&e.code===DOMException.NOT_FOUND_ERR?(this.isLink=!1,console.log("连接设备出错:",e)):(console.error("连接设备出错:",e),this.isLink=!1)}},async ReadDataMessage(e){const t=new Uint8Array(e.target.value.buffer);var a=t.length;for(let u=0;u<a;u++)this.readDataList.push(t[u]);a=this.readDataList.length;var s=[];for(let u=0;u<a;u++)if(255==this.readDataList[u]&&255==this.readDataList[u+1]){var o=this.readDataList[u+2];if(!(u+3+o<=a))return;var n=o;for(let e=0;e<o-1;e++)n+=this.readDataList[u+3+e];if(n%=256,n==this.readDataList[u+2+o]){var i=2+o+1,r=[];for(let e=0;e<i;e++)r.push(this.readDataList[u+e]);u=u+2+o,s.push(r)}}if(s.length>0){for(let e=0;e<s.length;e++)for(let t=0;t<s[e].length;t++)this.readDataList.shift();for(let t=0;t<s.length;t++)if(255==s[t][0]&&255==s[t][1]&&15==s[t][3]);else if(255==s[t][0]&&255==s[t][1]&&16==s[t][3]){var l=s[t].slice(4,s[t].length-1);console.log("2:"+l),this.actionNames.push("龙型:"+u().decode(l,"GB18030"))}else if(255==s[t][0]&&255==s[t][1]&&3==s[t][2]&&250==s[t][3]&&250==s[t][4]){if(this.isAction){this.isAction=!1;e=[];e.push(22);var c=Array.from(u().encode("RobotAction","GB18030"));for(let t=0;t<c.length;t++)e.push(c[t]);this.isRobotAction=!0,this.SendDataFormatMessage(e)}console.log("双Fa判断结果:"+this.musicFlag)}else if(255==s[t][0]&&255==s[t][1]&&3==s[t][2]&&250==s[t][3]&&253==s[t][4])console.log("fa fd判断结果:"+this.musicFlag);else if(255==s[t][0]&&255==s[t][1]&&22==s[t][3]){l=s[t].slice(4,s[t].length-1);this.actionNames.push("人型:"+u().decode(l,"GB18030"))}else if(255==s[t][0]&&255==s[t][1]&&3==s[t][2]&&250==s[t][3]&&252==s[t][4])this.isRobotAction&&(this.isRobotAction=!1);else if(255==s[t][0]&&255==s[t][1]&&23==s[t][3])this.actionExePorgress=s[t][4],100==s[t][4]&&(this.isActionExePorgress=!1);else if(255==s[t][0]&&255==s[t][1]&&220==s[t][3]&&79==s[t][4]&&75==s[t][5]){e=this.sendPosData[this.isSendPdFlag][0];console.log("第"+this.isSendPdFlag+"个动作文件创建成功，发送首帧"),this.SendDataFormatMessage(e)}else if(255==s[t][0]&&255==s[t][1]&&227==s[t][3]&&79==s[t][4]&&75==s[t][5]){a=this.sendPosData[this.isSendPdFlag].length;if(a-1==this.isSendPdFlagEach){if(this.isSendPdFlag=this.isSendPdFlag+1,this.sendPosDataNames.length==this.isSendPdFlag)console.log("动作文件发送完成"),this.isSendPosData=!1;else if(this.isSendPdFlag<this.sendPosDataNames.length){this.isSendPdFlagEach=0;var h=this.sendPosDataNames[this.isSendPdFlag],p=this.nameDataDispose(h),d=[];d.push(220);for(let e=0;e<p.length;e++)d.push(p[e]);console.log("发送第"+this.isSendPdFlag+"个动作文件"),this.SendDataFormatMessage(d)}}else{this.isSendPdFlagEach=this.isSendPdFlagEach+1;e=this.sendPosData[this.isSendPdFlag][this.isSendPdFlagEach];console.log("发送第"+this.isSendPdFlagEach+"帧"),this.SendDataFormatMessage(e)}}else if(255==s[t][0]&&255==s[t][1]&&24==s[t][3]){l=s[t].slice(4,s[t].length-1);console.log(u().decode(l,"GB18030")),this.musicFlag++}}},async SendDataFormatMessage(e){var t=[];t.push(255),t.push(255),t.push(e.length+1);var a=e.length+1;for(let s=0;s<e.length;s++)t.push(e[s]),a+=e[s];t.push(a%256),await this.characteristic.writeValue(new Uint8Array(t))},async UploadFileName(){if(this.isLink&&0==this.isAction&&0==this.isRobotAction){this.actionNames=[];var e=[];e.push(16),this.isAction=!0,this.SendDataFormatMessage(e)}},async performDance(){if(this.isLink&&""!=this.selectActionName&&0==this.isActionExePorgress){this.isActionExePorgress=!0,this.actionExePorgress=0;var e=this.selectActionName.substring(0,3),t=this.selectActionName.substring(3);"人型:"==e?e="RobotAction/":"龙型:"==e&&(e="Action/"),t=e+t;var a=Array.from(u().encode(t,"GB18030")),s=[];s.push(23);for(let e=0;e<a.length;e++)s.push(a[e]);this.SendDataFormatMessage(s)}},async actionDownload(e){var t=e.target.files[0],a=new FileReader;a.readAsText(t,"UTF-8"),a.onload=async e=>{const t=e.target.result,a=t.trim().split("\n").length;var s=[];for(let V=0;V<a;V++){const e=t.split("\r\n")[V].split(",")[0],a=e.split(/\s+/).map((e=>isNaN(e)?e:""==e?" ":Number(e)));s.push(a)}if(1==this.isLink&&0==this.isSendPosData){this.isSendPosData=!0,this.sendPosData=[[]],this.isSendPdFlag=0,this.isSendPdFlagEach=0;var o=[],n=[],i=s.length;for(let t=0;t<i;t++){var r=!1;" "==s[t][0]&&(r=!0),253==s[t][0]&&253==s[t][1]&&254==s[t][2]&&" "!=s[t][3]&&o.push(s[t][3]),1==r&&n.push(s[t])}var l=0;i=n.length;var c=[];for(let t=0;t<i;t++){var h=n[t][5],u=n[t][6],p=n[t][7],d=n[t][8],f=n[t][9],g=n[t][10];for(let e=0;e<8;e++){let a=h&Math.pow(2,7-e);0!=a&&(n[t][e+11]*=-1)}for(let e=0;e<8;e++){let a=u&Math.pow(2,7-e);0!=a&&(n[t][e+19]*=-1)}for(let e=0;e<8;e++){let a=p&Math.pow(2,7-e);0!=a&&(n[t][e+27]*=-1)}for(let e=0;e<8;e++){let a=d&Math.pow(2,7-e);0!=a&&(n[t][e+35]*=-1)}for(let e=0;e<8;e++){let a=f&Math.pow(2,7-e);0!=a&&(n[t][e+43]*=-1)}for(let e=0;e<8;e++){let a=g&Math.pow(2,7-e);0!=a&&(n[t][e+51]*=-1)}var m=0,v=!1,w=!1;0!=n[t][4]&&n[t][4]>128?m=n[t][4]-128:0!=n[t][4]&&n[t][4]<128?(m=n[t][4],v=!1,w=!0):0==n[t][4]&&(v=!1,w=!1);var _=[],b=n[t][3];for(let e=0;e<48;e++)_[e]=n[t][e+11];var P=n[t][59],y=n[t][60],k=0,D=-1,S=-1,F=0,L=n[t].length-2;63==L?(251!=n[t][61]&&251!=n[t][62]&&252!=n[t][61]&&252!=n[t][62]?(S=256*n[t][61]+n[t][62],k=2):251==n[t][61]&&251==n[t][62]?k=4:252==n[t][61]&&252==n[t][62]&&(k=3),D=S):61==L&&(S=0,k=2),F=n[t][n[t].length-2],D=S,0!=n[t][4]&&(v=0==l,n[t][4]<128?(w=!0,m=n[t][4]):(w=!1,m=n[t][4]-128)),l=n[t][4]>128?n[t][4]:0;var M={number:b,Name:1,Pos:_,Speed:P,Delay:y,Loop_Time:m,Is_Loop_Start:v,Is_Loop_End:w,Music_State:k,Music_Number:D,Is_Cur_Form:F};c.push(Ie(M))}this.sendPosDataNames=o,i=c.length;let e=0;m=-1;var I=!1,A=[[]],N=c[0].number;A[0]=[];for(let t=0;t<i;t++){N!=c[t].number&&(N=c[t].number,e++,A[e]=[]);var x=[];x.push(227),I||(x[1]=0),!I||c[t].Is_Loop_Start||c[t].Is_Loop_End||(x[1]=m+128),c[t].Is_Loop_End&&(I=!1,x[1]=m,m=0),c[t].Is_Loop_Start&&(I=!0,m=c[t].Loop_Time,x[1]=m+128);var C=0,T=0,U=0,B=0,E=0,O=0;for(let e=0;e<48;e++)e<8&&c[t].Pos[e]<0&&(C+=parseInt(Math.pow(2,7-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=8&&e<16&&c[t].Pos[e]<0&&(T+=parseInt(Math.pow(2,15-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=16&&e<24&&c[t].Pos[e]<0&&(U+=parseInt(Math.pow(2,23-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=24&&e<32&&c[t].Pos[e]<0&&(B+=parseInt(Math.pow(2,31-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=32&&e<40&&c[t].Pos[e]<0&&(E+=parseInt(Math.pow(2,39-e)),c[t].Pos[e]=-1*c[t].Pos[e]),e>=40&&e<48&&c[t].Pos[e]<0&&(O+=parseInt(Math.pow(2,47-e)),c[t].Pos[e]=-1*c[t].Pos[e]);x[2]=C,x[3]=T,x[4]=U,x[5]=B,x[6]=E,x[7]=O;for(let e=0;e<48;e++)x[e+8]=c[t].Pos[e];switch(x[56]=c[t].Speed,x[57]=c[t].Delay,c[t].Music_State){case 1:x[58]=parseInt(c[t].Music_Number/256),x[59]=parseInt(c[t].Music_Number%256);break;case 2:x[58]=parseInt(c[t].Music_Number/256),x[59]=parseInt(c[t].Music_Number%256);break;case 3:x[58]=252,x[59]=252;break;case 4:x[58]=251,x[59]=251;break}x[60]=c[t].Is_Cur_Form,A[e].push(x)}this.sendPosData=A;var R=this.sendPosDataNames[0],W=this.nameDataDispose(R),G=[];G.push(220);for(let t=0;t<W.length;t++)G.push(W[t]);console.log("创建首个动作文件"),this.SendDataFormatMessage(G)}}},nameDataDispose(e){var t=e.substring(0,3),a=e.substring(3);"人型:"==t?t="RobotAction/":"龙型:"==t&&(t="Action/"),a=t+a+".sh";var s=Array.from(u().encode(a,"GB18030"));return s},async GetMusic(){try{if(this.isLink){this.musicFlag=0;var e=[];e.push(24);var t=Array.from(u().encode("21","GB18030"));for(let a=0;a<t.length;a++)e.push(t[a]);this.SendDataFormatMessage(e)}}catch(a){console.error(a)}}}};const Je=(0,d.Z)(Ke,[["render",$e]]);var Qe=Je;const Xe=(0,s._)("p",null,null,-1);function et(e,t,a,o,n,i){const r=(0,s.up)("el-button");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(r,{onClick:i.connectToDevice},{default:(0,s.w5)((()=>[(0,s.Uk)("连接蓝牙设备")])),_:1},8,["onClick"]),Xe,(0,s.Wm)(r,{onClick:i.UploadActionFileNames},{default:(0,s.w5)((()=>[(0,s.Uk)("上传动作文件名")])),_:1},8,["onClick"])],64)}var tt={data(){return{isLink:!1,device:[],server:[],characteristic:[],Crc16_Table:[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8e3,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16e3,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32e3,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448],vOpentions:[],vOpentionsList:[],selectedOption:"",isUpFileName:!1,upFileNameFlag:0,fileNameList:[]}},methods:{async connectToDevice(){try{const e={filters:[{namePrefix:"BUZZ"}],optionalServices:[65472]};await navigator.bluetooth.requestDevice(e).then((async e=>{if(this.device=e,this.server=await this.device.gatt.connect(),await new Promise((e=>setTimeout(e,1e3))),this.server.connected){console.log(1);const e=await this.server.getPrimaryServices(65472);this.characteristic=await e[0].getCharacteristic(65473),this.characteristic.startNotifications(),this.characteristic.addEventListener("characteristicvaluechanged",this.ReadDataMessage),this.isLink=!0}}))}catch(e){e instanceof DOMException&&e.code===DOMException.NOT_FOUND_ERR?(this.isLink=!1,console.log("连接设备出错:",e)):(this.isLink=!1,console.error(e))}},async ReadDataMessage(e){const t=new Uint8Array(e.target.value.buffer);console.log(t);var a=t.length;for(let p=0;p<a;p++)if(85==t[p]&&170==t[p+1]){var s=t[p+2],o=t[p+3],n=s<<8|o,i=t[p+4],r=t[p+5];if(19==i&&22==r){var l=t[p+3+n-2],c=t[p+3+n-1],h=l<<8|c,u=65535;for(let e=0;e<n-1;e++)u=u>>8^this.Crc16_Table[255&(u^t[p+2+e])];u==h?this.upFileNameFlag:console.log("验证失败")}}},async SendDataFormatMessage(e){var t=[],a=65535,s=[];t.push(85),t.push(170);var o=e.length+3;t.push(o>>8&255),s.push(o>>8&255),t.push(255&o),s.push(255&o);for(let i=0;i<e.length;i++)t.push(e[i]),s.push(e[i]);for(let i of s)a=a>>8^this.Crc16_Table[255&(a^i)];t.push(a>>8&255),t.push(255&a);var n=0;for(let i=0;i<t.length;i++)n+=t[i];t.push(255&n),console.log(t),await this.characteristic.writeValue(new Uint8Array(t))},async UploadActionFileNames(){if(this.isLink&&0==this.isUpFileName){this.isUpFileName=!0,this.upFileNameFlag=0;var e=[];e.push(19),e.push(22);var t=Array.from(u().encode("Action/rack","GB18030"));for(let a=0;a<t.length;a++)e.push(t[a]);console.log(e),this.SendDataFormatMessage(e)}}}};const at=(0,d.Z)(tt,[["render",et]]);var st=at;const ot=(0,s._)("h1",null,"测试抽象工厂",-1),nt=(0,s.uE)("<br><button>进入蓝牙编程模式</button><button>退出蓝牙编程模式</button><br><button>全部上锁</button><br><button>全部解锁</button><br><button>单轴上解锁</button><br><button>单轴运动</button><br><button>绝对的路径上传文件</button><br><button>绝对路径执行动作文件</button>",15);function it(e,t,a,o,n,i){return(0,s.wg)(),(0,s.iD)(s.HY,null,[ot,(0,s._)("button",{onClick:t[0]||(t[0]=(...e)=>i.connectToDevice&&i.connectToDevice(...e))},"连接"),(0,s._)("button",{onClick:t[1]||(t[1]=(...e)=>i.disconnectBT&&i.disconnectBT(...e))},"断开"),nt],64)}class rt{GetFactory(e){}}class lt{async RobotBlueToothConntect(e){}async RobotBlueToothBreak(){}async IntoBlueToothProgram(){}}var ct=a(7327);class ht{}(0,ct.Z)(ht,"succeed","1000"),(0,ct.Z)(ht,"fail","1001"),(0,ct.Z)(ht,"timeout","1002"),(0,ct.Z)(ht,"ununited","1003"),(0,ct.Z)(ht,"isErr","1004"),(0,ct.Z)(ht,"callOff","1005");var ut=null,pt=null,dt=!1,ft=!1,gt=[],mt=[],vt=null,wt=null;class _t extends lt{async RobotBlueToothConntect(e){try{if(ut=null,ut=await e.gatt.connect(),await new Promise((e=>setTimeout(e,1e3))),pt=null,dt=!1,mt=[],gt=[],ut.connected){const t=await ut.getPrimaryServices(65504);return pt=await t[0].getCharacteristic(65505),pt.startNotifications(),pt.addEventListener("characteristicvaluechanged",this.ReadDataMessage),dt=!0,vt=new Promise(((e,t)=>{setInterval((()=>{this.SendDataMessage}),80)})),wt=setInterval((()=>{e.gatt.connected||(clearInterval(wt),this.onDisconnected())}),1e3),{BlueLink:ht.succeed,Meg:"连接成功！",instance:this}}return{BlueLink:ht.fail,Meg:"链接失败"}}catch(t){return dt=!1,{BlueLink:ht.isErr,Meg:t}}}async ReadDataMessage(e){const t=new Uint8Array(e.target.value.buffer);var a=t.length;for(let l=0;l<a;l++)gt.push(t[l]);a=gt.length;var s=[];for(let l=0;l<a;l++)if(255==gt[l]&&255==gt[l+1]){var o=gt[l+2];if(!(l+3+o<=a))return;var n=o;for(let e=0;e<o-1;e++)n+=gt[l+3+e];if(n%=256,n==gt[l+2+o]){var i=2+o+1,r=[];for(let e=0;e<i;e++)r.push(gt[l+e]);l=l+2+o,s.push(r)}}if(s.length>0){for(let e=0;e<s.length;e++)for(let t=0;t<s[e].length;t++)gt.shift();for(let e=0;e<s.length;e++)console.log(s[e])}}async SendDataMessage(){try{if(1==dt){var e=mt.length;for(let a=0;a<e;a++){let e=new Promise(((e,t)=>{setTimeout((()=>e()),50)}));await e;var t=mt.shift();await pt.writeValue(new Uint8Array(t))}}}catch(a){console.error(a)}}SendDataFormat(e){var t=[];t.push(255),t.push(255),t.push(e.length+1);var a=e.length+1;for(let s=0;s<e.length;s++)t.push(e[s]),a+=e[s];t.push(a%256),mt.push(t)}onDisconnected(){clearInterval(vt),pt.removeEventListener("characteristicvaluechanged",this.ReadDataMessage),mt=[],gt=[],dt=null,pt=null,ut=null,console.log("蓝牙已经断开")}async RobotBlueToothBreak(){try{const e=await navigator.bluetooth.getAvailability();if(e)return ut.disconnect(),clearInterval(wt),this.onDisconnected(),{BlueLink:ht.succeed,Meg:"断开成功！"}}catch(e){return{BlueLink:ht.isErr,Meg:e}}}async IntoBlueToothProgram(){try{if(!dt)return{BlueLink:ht.ununited,Meg:null};{var e;ft=!1;var t=[];t.push(230);const a=new Promise(((t,a)=>{const s=setInterval((()=>{1==ft&&(clearInterval(s),clearTimeout(e),t())}),100);e=setTimeout((()=>{clearInterval(s)}),1e4)}));a.then((()=>{if(!ft)return{BlueLink:ht.ununited,Meg:null}}))}}catch(a){return{BlueLink:ht.fail,Meg:a}}}}var bt=null,Pt=[];class yt extends lt{async RobotBlueToothConntect(e){try{var t=await e.gatt.connect();if(await new Promise((e=>setTimeout(e,1e3))),bt=null,!1,t.connected){const e=await t.getPrimaryServices(65504);return bt=await e[0].getCharacteristic(65505),bt.startNotifications(),bt.addEventListener("characteristicvaluechanged",this.ReadDataMessage),!0,{BlueLink:!0,Meg:"连接成功！"}}}catch(a){return!1,{BlueLink:!1,Meg:a}}}async ReadDataMessage(e){const t=new Uint8Array(e.target.value.buffer);var a=t.length;for(let l=0;l<a;l++)Pt.push(t[l]);a=Pt.length;var s=[];for(let l=0;l<a;l++)if(255==Pt[l]&&255==Pt[l+1]){var o=Pt[l+2];if(!(l+3+o<=a))return;var n=o;for(let e=0;e<o-1;e++)n+=Pt[l+3+e];if(n%=256,n==Pt[l+2+o]){var i=2+o+1,r=[];for(let e=0;e<i;e++)r.push(this.readDataList[l+e]);l=l+2+o,s.push(r)}}if(s.length>0)for(let l=0;l<s.length;l++)for(let e=0;e<s[l].length;e++)Pt.shift()}}var kt=null;class Dt extends rt{async BlueToothDispose(){try{const t={filters:[{namePrefix:"K1"},{namePrefix:"OP"},{namePrefix:"GSEG"},{namePrefix:"CTGEN"}],optionalServices:[65504]};var e=null;return await navigator.bluetooth.requestDevice(t).then((async t=>{kt=t.name.startsWith("OP")?this.GetFactory(0):t.name.startsWith("CTGEN")?this.GetFactory(1):null,e=null!=kt?await kt.RobotBlueToothConntect(t):{BlueLink:ht.fail,Meg:"无该型号机器人"}})),e}catch(t){return{BlueLink:ht.isErr,Meg:t}}}GetFactory(e){var t=null;switch(e){case 0:t=new yt;break;case 1:t=new _t;break;default:t=null;break}return t}}var St={data(){return{robotTest:[]}},methods:{async connectToDevice(){this.robotTest=new Dt;const e=await this.robotTest.BlueToothDispose();console.log(e),e.BlueLink==ht.succeed?this.robotTest=e.instance:console.log("没链接")},async disconnectBT(){this.robotTest.RobotBlueToothBreak()},async InitBTProgram(){}},mounted(){}};const Ft=(0,d.Z)(St,[["render",it]]);var Lt=Ft;const Mt=(0,o.p7)({mode:"hash",history:(0,o.r5)(),routes:[{path:"/",name:"HomePage",component:g},{path:"/Convoy_Seven",name:"Convoy_Seven",component:$},{path:"/Bumblebee",name:"Bumblebee",component:ue},{path:"/SteelCable",name:"SteelCable",component:xe},{path:"/Bluetooth",name:"Bluetooth",component:Be},{path:"/BluetoothBumblebee",name:"BluetoothBumblebee",component:He},{path:"/BluetoothSteelCable",name:"BluetoothSteelCable",component:Qe},{path:"/BluetoothBazz",name:"BluetoothBazz",component:st},{path:"/TestFactory",name:"TestFactory",component:Lt}]});var It=Mt,At=a(2219);a(4415);const Nt={id:"app"};function xt(e,t){const a=(0,s.up)("router-view");return(0,s.wg)(),(0,s.iD)("div",Nt,[(0,s.Wm)(a)])}const Ct={},Tt=(0,d.Z)(Ct,[["render",xt]]);var Ut=Tt;const Bt=(0,s.ri)(Ut);Bt.use(It),Bt.use(At.Z),Bt.mount("#app")},5832:function(){}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,s,o,n){if(!s){var i=1/0;for(h=0;h<e.length;h++){s=e[h][0],o=e[h][1],n=e[h][2];for(var r=!0,l=0;l<s.length;l++)(!1&n||i>=n)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(r=!1,n<i&&(i=n));if(r){e.splice(h--,1);var c=o();void 0!==c&&(t=c)}}return t}n=n||0;for(var h=e.length;h>0&&e[h-1][2]>n;h--)e[h]=e[h-1];e[h]=[s,o,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var o,n,i=s[0],r=s[1],l=s[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(o in r)a.o(r,o)&&(a.m[o]=r[o]);if(l)var h=l(a)}for(t&&t(s);c<i.length;c++)n=i[c],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(h)},s=self["webpackChunkrobot_comm_model"]=self["webpackChunkrobot_comm_model"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(2785)}));s=a.O(s)})();
//# sourceMappingURL=app.ac41ae4f.js.map